import{d as ee,I as ae,r as e,o as te,f as p,c as h,e as c,b as r,g as me,t as _,F as O,i as pe,A as T,v as N,x as P,M as fe,k as se,w as B,G as Z,C as ye,_ as le,V as he,h as ge}from"./index-DD0chK9m.js";import{H as Ae}from"./HeaderSection-BqWuRDgu.js";import{A as we,a as qe,b as _e,c as Pe,U as Ve}from"./AddPlayerDialog-4_fjKbik.js";import{D as ke}from"./DashboardWelcome-CxMUSv8I.js";import{P as $e}from"./PlayerModalDialog-e3S7FNpc.js";import{V as De}from"./VSelect-BpGEebQz.js";import{L as Re}from"./LoadMoreButton-Cql9AWZ4.js";import{V as Ue}from"./VSnackbar-DOp5kfB_.js";import"./VAlert-BswZB0pH.js";import"./VForm-D4HHFwdz.js";import"./VSpacer-DKUpOtpE.js";import"./VDialog-8pvQ3nO6.js";import"./dialog-transition-ChtNxUt0.js";import"./VAutocomplete-CIS9KaFs.js";import"./VFileInput-DO4WOKog.js";const Ee={class:"history-card"},Te={class:"history-content"},Le={class:"filter-options"},be={key:0,class:"d-flex justify-center align-center",style:{height:"200px"}},je={key:1,class:"error-message"},Ce={key:2,class:"request-list"},Me={class:"request-header"},Fe={class:"request-type"},Se={class:"request-details"},Ne={class:"detail-item"},Be={class:"detail-item"},ze={key:0,class:"detail-item"},xe=["onClick"],He={class:"request-actions"},Oe={key:3,class:"error-message"},Ge=ee({__name:"AdminRequestManagement",props:{requests:{},limit:{},isLoadMore:{type:Boolean}},emits:["player-click","update:requests"],setup(G,{emit:z}){const g=ae(),V=e(!0),f=e(null),k=e(null),u=e(""),A=e({}),d=e({}),w=["Pending","Accepted","Rejected"],$=e(!1),D=e(!1),L=e(""),R=e(!1),y=e(null),U=e(!1),m=G,b=z,j=t=>ye(new Date(t),"dd MMM yyyy, HH:mm"),C=t=>t.split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),q=t=>t.charAt(0).toUpperCase()+t.slice(1),M=t=>t==="promote user to director"?"mdi-shield-account":t==="link user to player"?"mdi-account-plus":"mdi-help",E=async()=>{try{V.value=!0,f.value=null;const t=u.value&&u.value!=="All"?`&status=${u.value.toLowerCase()}`:"",s=m.isLoadMore?m.requests.length:0,a=await fetch(`${T}/requests?offset=${s}&limit=${m.limit||5}${t}`,{headers:{Authorization:`Bearer ${g.token}`}});if(!a.ok){const i=await a.json();throw new Error(i.message||"No requests found.")}const l=await a.json();m.isLoadMore?b("update:requests",[...m.requests,...l]):b("update:requests",l)}catch(t){console.error("Error fetching requests:",t),f.value="Failed to load request history. Please try again later."}finally{V.value=!1}},F=async t=>{try{A.value[t]=!0,$.value=!0;const s=await fetch(`${T}/requests/${t}?status=accepted`,{method:"PUT",headers:{Authorization:`Bearer ${g.token}`}});if(!s.ok){const l=await s.json();throw new Error(l.message||"Failed to approve request")}const a=m.requests.find(l=>l.id===t);if(a&&a.username){const l=m.requests.filter(i=>i.id!==t&&i.status==="pending"&&i.username===a.username);for(const i of l)await fetch(`${T}/requests/${i.id}?status=rejected`,{method:"PUT",headers:{Authorization:`Bearer ${g.token}`}})}L.value="Request approved successfully.",D.value=!0,await E()}catch(s){console.error("Error approving request:",s),k.value="Failed to approve request. Please try again."}finally{$.value=!1,A.value[t]=!1}},S=async t=>{var s,a;try{d.value[t]=!0,$.value=!0;const l=await fetch(`${T}/requests/${t}?status=rejected`,{method:"PUT",headers:{Authorization:`Bearer ${g.token}`}});if(!l.ok){const i=await l.json();throw console.error("API Error:",i),new Error(((a=(s=i.detail)==null?void 0:s[0])==null?void 0:a.msg)||"Failed to reject request")}L.value="Request rejected successfully.",D.value=!0,await E()}catch(l){console.error("Error rejecting request:",l),k.value=l.message||"Failed to reject request. Please try again."}finally{$.value=!1,d.value[t]=!1}},x=async t=>{try{R.value=!0;const s=await fetch(`${T}/players?search=${encodeURIComponent(t)}`);if(!s.ok)throw new Error("Failed to fetch player");const a=await s.json();a.length>0&&(y.value=a[0],U.value=!0)}catch(s){console.error("Error fetching player:",s)}finally{R.value=!1}};return te(()=>{E()}),(t,s)=>(p(),h(O,null,[c("div",Ee,[c("div",Te,[c("div",Le,[r(De,{modelValue:u.value,"onUpdate:modelValue":[s[0]||(s[0]=a=>u.value=a),E],items:w,"item-title":"text","item-value":"value",label:"Filter by Status",variant:"outlined",density:"comfortable","bg-color":"rgba(45, 55, 75, 0.4)",color:"#42DDF2FF",clearable:""},null,8,["modelValue"])]),V.value?(p(),h("div",be,[r(me,{indeterminate:"",color:"#42DDF2FF"})])):f.value?(p(),h("div",je,_(f.value),1)):t.requests.length>0?(p(),h("div",Ce,[(p(!0),h(O,null,pe(t.requests,a=>(p(),h("div",{key:a.id,class:"request-item"},[c("div",Me,[c("div",Fe,[r(N,{icon:M(a.request_type),class:"request-icon"},null,8,["icon"]),P(" "+_(C(a.request_type)),1)]),c("div",{class:fe(["status-tag",`status-${a.status}`])},_(q(a.status)),3)]),c("div",Se,[c("div",Ne,[r(N,{icon:"mdi-calendar",size:"small",class:"detail-icon"}),P(" "+_(j(a.request_date)),1)]),c("div",Be,[r(N,{icon:"mdi-email",size:"small",class:"detail-icon"}),P(" User Email: "+_(a.email),1)]),a.username?(p(),h("div",ze,[r(N,{icon:"mdi-account",size:"small",class:"detail-icon"}),s[2]||(s[2]=P(" Player: ")),c("span",{class:"request-player-link",onClick:l=>x(a.username)},_(a.username),9,xe)])):se("",!0)]),c("div",He,[r(Z,{class:"approve-btn",onClick:l=>F(a.id),loading:A.value[a.id],disabled:a.status!=="pending"||A.value[a.id]||d.value[a.id]},{default:B(()=>s[3]||(s[3]=[P(" Approve ")])),_:2},1032,["onClick","loading","disabled"]),r(Z,{class:"reject-btn",onClick:l=>S(a.id),loading:d.value[a.id],disabled:a.status!=="pending"||A.value[a.id]||d.value[a.id]},{default:B(()=>s[4]||(s[4]=[P(" Reject ")])),_:2},1032,["onClick","loading","disabled"])])]))),128))])):(p(),h("div",Oe," No requests found. "))])]),r($e,{modelValue:U.value,"onUpdate:modelValue":s[1]||(s[1]=a=>U.value=a),player:y.value},null,8,["modelValue","player"])],64))}}),Ie=le(Ge,[["__scopeId","data-v-274020af"]]),Qe={class:"content-wrapper"},We=ee({__name:"DashboardAdmin",setup(G){const z=ae(),g=e(!1),V=e(!0),f=e(!1),k=e(5),u=e([]);e(!0);const A=e(null),d=e(!1),w=e(""),$=e(""),D=e(""),L=e(""),R=e(""),y=e(null),U=e(""),m=e(""),b=e(""),j=e(null),C=e(null),q=e(""),M=e(!1),E=e(""),F=e(!1),S=e(!1),x=e(""),t=e(""),s=e(null),a=e(!1),l=e(""),i=e(""),I=e(""),Q=e(""),oe=()=>{d.value=!0,w.value="Team added successfully!"},re=()=>{d.value=!0,w.value="Tournament created successfully!"},ne=v=>{d.value=!0,w.value=`Player ${v.username} was successfully added!`},ue=v=>{d.value=!0,w.value=`Player ${v.username} was successfully updated!`},ie=async()=>{await J(!0)},de=()=>{l.value="",i.value="",I.value="",Q.value=""},W=async()=>{j.value=null,C.value&&URL.revokeObjectURL(C.value),C.value=null,L.value="",R.value="",U.value="",m.value="",b.value="",j.value=null,q.value="",a.value=!0},J=async(v=!1)=>{try{v?f.value=!0:g.value=!0,A.value=null;const o=D.value&&D.value!=="All"?`&status=${D.value.toLowerCase()}`:"",n=await fetch(`${T}/requests?offset=${v?u.value.length:0}&limit=${k.value}${o}`,{method:"GET",headers:{Authorization:`Bearer ${z.token}`}});if(!n.ok){const ve=await n.json();throw new Error(ve.message||"No requests found.")}const H=await n.json();v?u.value=[...u.value,...H]:u.value=H,V.value=H.length===k.value}catch(o){console.error("Error fetching requests:",o),A.value=o.message||"Failed to load request history. Please try again later."}finally{g.value=!1,f.value=!1}},K=()=>{E.value="",$.value=null,M.value=!0},X=()=>{x.value="",s.value=null,t.value="",S.value=!0},Y=async()=>{de(),R.value="",l.value="",i.value="",I.value="",Q.value="",L.value="",R.value="",y.value=null,U.value="",m.value="",b.value="",j.value=null,q.value="",F.value=!0,y.value&&y.value.team_id&&(q.value=y.value.team_id)},ce=()=>{var v;(v=y.value)!=null&&v.team_id?q.value=y.value.team_id:q.value=""};return te(()=>{ce(),J()}),(v,o)=>(p(),h(O,null,[r(Ae),c("div",Qe,[r(he,null,{default:B(()=>[r(ke,{userRole:"Admin"}),r(we,{openAddTournamentDialog:K,openAddTeamDialog:X,openAddPlayerDialog:W,openUpdatePlayerDialog:Y,onOpenTournament:K,onOpenTeam:X,onOpenPlayer:W,onOpenUpdatePlayer:Y}),r(Ie,{requests:u.value,"onUpdate:requests":[o[0]||(o[0]=n=>u.value=n),o[1]||(o[1]=n=>u.value=n)],limit:k.value,isLoadMore:f.value},null,8,["requests","limit","isLoadMore"]),r(qe,{modelValue:M.value,"onUpdate:modelValue":o[2]||(o[2]=n=>M.value=n),onTournamentAdded:re},null,8,["modelValue"]),r(_e,{modelValue:S.value,"onUpdate:modelValue":o[3]||(o[3]=n=>S.value=n),onTeamAdded:oe},null,8,["modelValue"]),r(Pe,{modelValue:a.value,"onUpdate:modelValue":o[4]||(o[4]=n=>a.value=n),onPlayerAdded:ne},null,8,["modelValue"]),r(Ve,{modelValue:F.value,"onUpdate:modelValue":o[5]||(o[5]=n=>F.value=n),onPlayerUpdated:ue},null,8,["modelValue"]),!g.value&&V.value?(p(),ge(Re,{key:0,"is-loading":f.value,"button-text":"Load More Requests",onLoadMore:ie},null,8,["is-loading"])):se("",!0),r(Ue,{modelValue:d.value,"onUpdate:modelValue":o[6]||(o[6]=n=>d.value=n),color:"success",timeout:"3000"},{default:B(()=>[P(_(w.value),1)]),_:1},8,["modelValue"])]),_:1})])],64))}}),da=le(We,[["__scopeId","data-v-e0c4ca4f"]]);export{da as default};
