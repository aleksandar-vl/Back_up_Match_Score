import{d as H,I as O,r as t,N as ue,f as C,c as x,e as i,b as l,w as c,h as z,u as ae,q as te,t as b,x as L,v as S,E as ce,k as R,_ as J,J as M,m as j,K as le,n as se,L as Q,O as me,s as ve,z as re,G as Z,D as oe,A as q,o as pe,V as fe,F as ye,j as ge,l as ee}from"./index-DD0chK9m.js";import{H as he}from"./HeaderSection-BqWuRDgu.js";import{D as _e}from"./DashboardWelcome-CxMUSv8I.js";import{V as Ve}from"./VSelect-BpGEebQz.js";import{V as ne}from"./VSpacer-DKUpOtpE.js";import{V as ie}from"./VDialog-8pvQ3nO6.js";import{V as we}from"./VFileInput-DO4WOKog.js";import{R as Fe}from"./RequestHistory-Dl0JT4OF.js";import{V as Ne}from"./VSnackbar-DOp5kfB_.js";import"./dialog-transition-ChtNxUt0.js";const Ae={class:"player-card"},Ee={class:"player-content"},ke={class:"player-main-info"},Ce={class:"avatar-section"},Ue={class:"info-section"},De={class:"info-row"},$e={class:"username"},be={class:"info-row"},Le={class:"full-name"},Pe={class:"info-row"},Se={class:"country"},ze={class:"info-row"},Ie={class:"team"},Te={class:"player-stats-section"},xe={class:"stats-container"},qe={class:"progress-wrapper"},Be={class:"win-ratio"},Re={key:0,class:"tournament-container"},je={class:"tournament-name"},Me=H({__name:"PlayerCard",props:{player:{},onEdit:{type:Function},onAvatarUpload:{type:Function}},emits:["edit","avatarUpload"],setup(B,{emit:P}){const a=P;O();const h=t(!1),U=t(null),_=t(null),E=t("");t(!1),t([]),t("");const p=()=>{console.log("PlayerCard: Avatar click detected"),U.value=null,_.value=null,E.value="",h.value=!0,a("avatarUpload")},F=o=>{console.log("PlayerCard: Emitting edit event with field:",o),a("edit",o)};return(o,m)=>{var f,V,r,s,v,w,I,T,$;const D=ue("router-link");return C(),x("div",Ae,[m[5]||(m[5]=i("div",{class:"player-background"},null,-1)),i("div",Ee,[i("div",ke,[i("div",Ce,[l(te,{size:"150",class:"player-avatar",onClick:p},{default:c(()=>{var A;return[(A=o.player)!=null&&A.avatar?(C(),z(ae,{key:0,src:o.player.avatar,alt:"Player avatar"},null,8,["src"])):(C(),z(S,{key:1,icon:"mdi-account",color:"#42DDF2FF",size:"80"}))]}),_:1})]),i("div",Ue,[i("div",De,[i("div",$e,b((f=o.player)==null?void 0:f.username),1)]),i("div",be,[i("div",Le,[L(b((V=o.player)==null?void 0:V.first_name)+" "+b((r=o.player)==null?void 0:r.last_name)+" ",1),l(S,{icon:"mdi-pencil",class:"edit-icon",onClick:m[0]||(m[0]=A=>F("name"))})])]),i("div",Pe,[i("div",Se,[l(S,{icon:"mdi-earth",class:"info-icon"}),L(" "+b((s=o.player)==null?void 0:s.country),1)]),l(S,{icon:"mdi-pencil",class:"edit-icon",onClick:m[1]||(m[1]=A=>F("country"))})]),i("div",ze,[l(D,{to:`/teams/${(v=o.player)==null?void 0:v.team_id}`,class:"link"},{default:c(()=>{var A;return[i("div",Ie,[l(S,{icon:"mdi-account-group",class:"info-icon"}),L(" "+b((A=o.player)==null?void 0:A.team_name),1)])]}),_:1},8,["to"]),l(S,{icon:"mdi-pencil",class:"edit-icon",onClick:m[2]||(m[2]=A=>F("team"))})])])]),i("div",Te,[i("div",xe,[m[3]||(m[3]=i("div",{class:"stats-header"},"My stats",-1)),i("div",qe,[l(ce,{"model-value":parseInt((w=o.player)==null?void 0:w.game_win_ratio),color:"#42DDF2FF",height:"8",rounded:"",class:"progress-bar"},null,8,["model-value"]),i("span",Be,b((I=o.player)==null?void 0:I.game_win_ratio),1)])]),(T=o.player)!=null&&T.current_tournament_title?(C(),x("div",Re,[l(D,{to:`/events/${($=o.player)==null?void 0:$.current_tournament_id}`,class:"link"},{default:c(()=>[m[4]||(m[4]=i("div",{class:"tournament-header"},"Current tournament",-1)),i("div",je,[l(S,{icon:"mdi-trophy",class:"tournament-icon"}),L(" "+b(o.player.current_tournament_title),1)])]),_:1},8,["to"])])):R("",!0)])])])}}}),Ze=J(Me,[["__scopeId","data-v-bd3f46f2"]]),He={class:"edit-dialog-content"},Oe={key:0,class:"d-flex gap-2"},Je={key:2},Ge={key:0,class:"text-caption error-text mt-2"},Ke=H({__name:"PlayerDashboardEditDialog",props:{modelValue:{type:Boolean},player:{},editField:{},editValue:{},editFirstName:{},editLastName:{}},emits:["update:modelValue","update:editValue","update:editFirstName","update:editLastName","profile-updated"],setup(B,{emit:P}){const a=B;console.log("EditDialog props:",{editField:a.editField,editValue:a.editValue,editFirstName:a.editFirstName,editLastName:a.editLastName});const h=P,U=M({get:()=>a.modelValue,set:e=>h("update:modelValue",e)}),_=e=>{h("update:editValue",e)},E=e=>{h("update:editFirstName",e)},p=e=>{h("update:editLastName",e)},F=O(),o=t([]),m=t(!1),D=t(!1);t(!0),t(null);const f=t(""),V=t(""),r=t(""),s=t(""),v=t(""),w={required:e=>!!e||"This field is required",firstName:[e=>!!e||"First name is required",e=>e.length>=2||"First name must be at least 2 characters",e=>e.length<=25||"First name must not exceed 25 characters",e=>/^[a-zA-Z]+(?:[-a-zA-Z]+)?$/.test(e)||"Invalid first name format"],lastName:[e=>!!e||"Last name is required",e=>e.length>=2||"Last name must be at least 2 characters",e=>e.length<=25||"Last name must not exceed 25 characters",e=>/^[a-zA-Z]+(?:[-a-zA-Z]+)?$/.test(e)||"Invalid last name format"],country:[e=>!!e||"Country is required",e=>e.length>=2||"Country must be at least 2 characters",e=>e.length<=25||"Country must not exceed 25 characters",e=>/^[a-zA-Z]+(?:[\s-][a-zA-Z]+)*$/.test(e)||"Invalid country format"]},I=M(()=>({name:"Edit Name",country:"Edit Country",team:"Edit Team Name"})[a.editField]||"Edit Profile"),T=()=>{U.value=!1,h("update:editValue",""),h("update:editFirstName",""),h("update:editLastName",""),v.value="",$()},$=()=>{f.value="",V.value="",r.value=""},A=async()=>{if($(),!!a.player)try{if(D.value=!0,v.value="",a.editField==="name"){if(!w.firstName.every(g=>g(a.editFirstName)===!0)){f.value="Invalid first name format";return}if(!w.lastName.every(g=>g(a.editLastName)===!0)){V.value="Invalid last name format";return}}else if(a.editField==="country"&&!w.country.every(g=>g(a.editValue)===!0)){r.value="Invalid country format";return}let e=new URLSearchParams;a.editField==="name"?(e.append("first_name",a.editFirstName),e.append("last_name",a.editLastName)):a.editField==="team"?e.append("team_name",a.editValue):e.append(a.editField,a.editValue);const y=await fetch(`${q}/players/${a.player.id}?${e.toString()}`,{method:"PUT",headers:{Authorization:`Bearer ${F.token}`,"Content-Type":"application/json"}}),N=await y.json();if(!y.ok)throw v.value=N.detail||N.message||"Failed to update profile",new Error(v.value);U.value=!1,h("profile-updated",N)}catch(e){console.error("Error updating profile:",e),v.value||(v.value="Failed to update profile. Please try again.")}finally{D.value=!1}},G=M(()=>{if(!a.player||f.value||V.value||r.value||s.value||v.value)return!1;switch(a.editField){case"name":return(a.editFirstName!==a.player.first_name||a.editLastName!==a.player.last_name)&&w.firstName.every(e=>e(a.editFirstName)===!0)&&w.lastName.every(e=>e(a.editLastName)===!0);case"country":return a.editValue!==a.player.country&&w.country.every(e=>e(a.editValue)===!0);case"team":return a.editValue!==a.player.team_name;default:return!1}}),K=async()=>{try{m.value=!0,s.value="";const e=await fetch(`${q}/teams?has_space=true&offset=0&limit=100`,{headers:{Authorization:`Bearer ${F.token}`}});if(!e.ok){const N=await W(e);throw new Error(N)}const y=await e.json();o.value=y.map(N=>({name:N.name}))}catch(e){console.error("Error fetching teams:",e),s.value=e.message||"Failed to load teams"}finally{m.value=!1}},W=async e=>{try{const N=await e.clone().text(),g=JSON.parse(N);return g.detail&&Array.isArray(g.detail)&&g.detail.length>0?g.detail[0].msg:g.detail&&typeof g.detail=="string"?g.detail:"An error occurred"}catch(y){return console.error("Error extracting message:",y),"An error occurred"}};return j(()=>a.modelValue,e=>{e&&a.editField==="team"&&K()}),j(()=>a.editFirstName,e=>{e&&f.value&&(f.value="")}),j(()=>a.editLastName,e=>{e&&V.value&&(V.value="")}),j(()=>a.editValue,e=>{a.editField==="country"&&r.value&&(r.value=""),a.editField==="team"&&s.value&&(s.value="")}),(e,y)=>(C(),z(ie,{modelValue:U.value,"onUpdate:modelValue":y[0]||(y[0]=N=>U.value=N),"max-width":"400px",class:"dialog-radius"},{default:c(()=>[l(oe,{class:"edit-dialog"},{default:c(()=>[i("div",He,[l(le,{class:"dialog-title"},{default:c(()=>[L(b(I.value),1)]),_:1}),l(se,null,{default:c(()=>[a.editField==="name"?(C(),x("div",Oe,[l(Q,{"model-value":a.editFirstName,"onUpdate:modelValue":E,label:"First Name",variant:"outlined",rules:w.firstName,"error-messages":f.value},null,8,["model-value","rules","error-messages"]),l(Q,{"model-value":a.editLastName,"onUpdate:modelValue":p,label:"Last Name",variant:"outlined",rules:w.lastName,"error-messages":V.value},null,8,["model-value","rules","error-messages"])])):R("",!0),a.editField==="country"?(C(),z(Q,{key:1,"model-value":a.editValue,"onUpdate:modelValue":_,label:"Country",variant:"outlined",rules:w.country,"error-messages":r.value},null,8,["model-value","rules","error-messages"])):R("",!0),a.editField==="team"?(C(),x("div",Je,[l(Ve,{"model-value":a.editValue,"onUpdate:modelValue":_,items:o.value,"item-title":"name","item-value":"name",label:"Select Team",variant:"outlined",loading:m.value,clearable:"","menu-props":{contentClass:"teams-menu"}},{item:c(({props:N,item:g})=>[l(me,ve(N,{title:g.raw.name,class:"team-list-item"}),null,16,["title"])]),_:1},8,["model-value","items","loading"]),s.value?(C(),x("div",Ge,b(s.value),1)):R("",!0)])):R("",!0)]),_:1}),l(re,{class:"dialog-actions"},{default:c(()=>[l(ne),l(Z,{class:"cancel-btn",onClick:T},{default:c(()=>y[1]||(y[1]=[L(" Cancel ")])),_:1}),l(Z,{class:"submit-btn",onClick:A,loading:D.value,disabled:!G.value},{default:c(()=>y[2]||(y[2]=[L(" Save ")])),_:1},8,["loading","disabled"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),We=J(Ke,[["__scopeId","data-v-63fd5d48"]]),Qe={class:"dialog-content"},Xe={class:"file-upload-section"},Ye=H({__name:"PlayerAvatarUpdateDialog",props:{modelValue:{type:Boolean},player:{}},emits:["update:modelValue","avatar-updated"],setup(B,{emit:P}){const a=B,h=P,U=O(),_=t(null),E=t(null),p=t(""),F=t(!1),o=M({get:()=>a.modelValue,set:r=>h("update:modelValue",r)}),m=r=>{let s=null;if(Array.isArray(r)?s=r[0]:r instanceof File?s=r:(r==null?void 0:r.target)instanceof HTMLInputElement&&r.target.files&&(s=r.target.files[0]),s){const v=new FileReader;v.onload=w=>{E.value=w.target.result},v.readAsDataURL(s),_.value=s}else E.value=null,_.value=null},D=()=>{_.value=null,E.value=null},f=()=>{o.value=!1,_.value=null,E.value=null,p.value=""},V=async()=>{if(!(!a.player||!_.value))try{F.value=!0,p.value="";const r=new FormData;r.append("avatar",_.value);const s=await fetch(`${q}/players/${a.player.id}`,{method:"PUT",headers:{Authorization:`Bearer ${U.token}`},body:r});if(!s.ok){const v=await s.json();throw p.value=v.detail||"Failed to upload avatar",new Error(p.value)}o.value=!1,h("avatar-updated")}catch(r){console.error("Upload error:",r),p.value||(p.value="Failed to upload avatar")}finally{F.value=!1}};return(r,s)=>(C(),z(ie,{modelValue:o.value,"onUpdate:modelValue":s[1]||(s[1]=v=>o.value=v),"max-width":"500"},{default:c(()=>[l(oe,{class:"dialog-card"},{default:c(()=>[i("div",Qe,[l(le,{class:"dialog-title"},{default:c(()=>s[2]||(s[2]=[i("span",null,"Update Avatar",-1)])),_:1}),l(se,null,{default:c(()=>[i("div",Xe,[l(te,{size:"120",class:"preview-avatar"},{default:c(()=>[E.value?(C(),z(ae,{key:0,src:E.value,alt:"Player avatar"},null,8,["src"])):(C(),z(S,{key:1,icon:"mdi-account",color:"#42DDF2FF",size:"48"}))]),_:1}),l(we,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=v=>_.value=v),label:"Player Avatar",variant:"outlined",accept:"image/*","show-size":!0,"prepend-icon":"mdi-camera",class:"upload-input",onChange:m,"onClick:clear":D,"hide-details":""},null,8,["modelValue"])])]),_:1}),l(re,null,{default:c(()=>[l(ne),l(Z,{class:"cancel-btn",onClick:f},{default:c(()=>s[3]||(s[3]=[L(" Cancel ")])),_:1}),l(Z,{class:"submit-btn",onClick:V,loading:F.value,disabled:!_.value},{default:c(()=>s[4]||(s[4]=[L(" Upload ")])),_:1},8,["loading","disabled"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),ea=J(Ye,[["__scopeId","data-v-6f1703b3"]]),aa={class:"content-wrapper"},ta=H({__name:"DashboardPlayer",setup(B){const P=O(),a=t([]),h=t(!1),U=t(""),_=t([]),E=t(null),p=t(null),F=t(!0),o=t(null),m=t(!1),D=t(""),f=t(""),V=t(""),r=t(""),s=t(""),v=t(!1),w=t(null),I=t(null),T=t("");t(!1);const $=t(!1),A=t(""),G=async()=>{await y(),$.value=!0,A.value="Profile updated successfully!"},K=async()=>{await y(),$.value=!0,A.value="Avatar updated successfully!"},W=async()=>{try{h.value=!0,U.value="";const n=await fetch(`${q}/teams`,{headers:{Authorization:`Bearer ${P.token}`}});if(!n.ok){const k=await g(n);throw new Error(k)}const d=await n.json();a.value=d.map(k=>({name:k.name}))}catch(n){console.error("Error fetching teams:",n),U.value=n.message||"Failed to load teams"}finally{h.value=!1}},e=async()=>{try{F.value=!0,E.value=null;const n=await fetch(`${q}/requests/me?offset=0&limit=10`,{method:"GET",headers:{Authorization:`Bearer ${P.token}`}});if(!n.ok){const k=await n.json();throw new Error(k.message||"Failed to fetch requests")}const d=await n.json();_.value=[...d]}catch(n){console.error("Error fetching requests:",n),E.value=n.message||"Failed to load request history. Please try again later."}finally{F.value=!1}},y=async()=>{try{F.value=!0,o.value=null;const n=await fetch(`${q}/players/users`,{headers:{Authorization:`Bearer ${P.token}`}});if(!n.ok)throw new Error("Failed to fetch player details");p.value=await n.json()}catch(n){console.error("Error fetching player:",n),o.value="Failed to load player details"}finally{F.value=!1}},N=async n=>{var d,k,u,X,Y;console.log("Opening edit dialog with field:",n),D.value=n,s.value="",n==="name"?(V.value=((d=p.value)==null?void 0:d.first_name)||"",r.value=((k=p.value)==null?void 0:k.last_name)||"",console.log("Setting name values:",{first:V.value,last:r.value})):n==="team"?(f.value=((u=p.value)==null?void 0:u.team_name)||"",await W(),console.log("Setting team value:",f.value)):(f.value=((Y=(X=p.value)==null?void 0:X[n])==null?void 0:Y.toString())||"",console.log("Setting field value:",f.value)),m.value=!0},g=async n=>{try{const k=await n.clone().text(),u=JSON.parse(k);return u.detail&&Array.isArray(u.detail)&&u.detail.length>0?u.detail[0].msg:u.detail&&typeof u.detail=="string"?u.detail:"An error occurred"}catch(d){return console.error("Error extracting message:",d),"An error occurred"}},de=()=>{w.value=null,I.value=null,T.value="",v.value=!0};return pe(()=>{e(),y()}),(n,d)=>(C(),x(ye,null,[l(he),i("div",aa,[l(fe,null,{default:c(()=>{var k;return[l(_e,{userRole:(k=p.value)==null?void 0:k.username},null,8,["userRole"]),l(ge,{class:"dashboard-row"},{default:c(()=>[l(ee,{cols:"12",md:"6"},{default:c(()=>[l(Ze,{player:p.value,onEdit:N,onAvatarUpload:de},null,8,["player"]),l(We,{modelValue:m.value,"onUpdate:modelValue":[d[0]||(d[0]=u=>m.value=u),d[1]||(d[1]=u=>m.value=u)],player:p.value,"edit-field":D.value,"edit-value":f.value,"edit-first-name":V.value,"edit-last-name":r.value,"onUpdate:editValue":d[2]||(d[2]=u=>f.value=u),"onUpdate:editFirstName":d[3]||(d[3]=u=>V.value=u),"onUpdate:editLastName":d[4]||(d[4]=u=>r.value=u),onProfileUpdated:G},null,8,["modelValue","player","edit-field","edit-value","edit-first-name","edit-last-name"]),l(ea,{modelValue:v.value,"onUpdate:modelValue":d[5]||(d[5]=u=>v.value=u),player:p.value,onAvatarUpdated:K},null,8,["modelValue","player"]),l(Ne,{modelValue:$.value,"onUpdate:modelValue":d[6]||(d[6]=u=>$.value=u),color:"success",timeout:"3000"},{default:c(()=>[L(b(A.value),1)]),_:1},8,["modelValue"])]),_:1}),l(ee,{cols:"12",md:"6"},{default:c(()=>[l(Fe)]),_:1})]),_:1})]}),_:1})])],64))}}),va=J(ta,[["__scopeId","data-v-1f363847"]]);export{va as default};
