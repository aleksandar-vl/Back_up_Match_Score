import{d as oe,r,f as C,c as Q,e as L,b as s,w as d,x as D,G as j,t as te,k as le,_ as ne,I as ue,J as B,o as ye,h as $,K as ie,n as se,L as x,i as ke,F as _e,z as de,D as me,A as K,O as ge,s as he,v as ce,q as Ve,u as be,P as Ce}from"./index-DD0chK9m.js";import{V as Ue}from"./VAlert-BswZB0pH.js";import{V as pe}from"./VForm-D4HHFwdz.js";import{V as Fe,a as Pe}from"./VSelect-BpGEebQz.js";import{V as ve}from"./VSpacer-DKUpOtpE.js";import{V as fe}from"./VDialog-8pvQ3nO6.js";import{V as we}from"./VAutocomplete-CIS9KaFs.js";import{V as Ae}from"./VFileInput-DO4WOKog.js";const Ee={class:"actions-card"},$e={class:"actions-content"},De={class:"actions-grid"},Ne={class:"actions-row"},Se={class:"actions-row"},Le={key:0,class:"error-message"},Ie=oe({__name:"AdminActions",props:{openAddTournamentDialog:{type:Function},openAddTeamDialog:{type:Function},openAddPlayerDialog:{type:Function},openUpdatePlayerDialog:{type:Function}},emits:["open-tournament","open-team","open-player","open-update-player"],setup(G,{emit:H}){const I=r(null),O=H,R=()=>{try{O("open-tournament")}catch(f){console.error("Error opening tournament dialog:",f),I.value="Failed to open tournament dialog"}},U=()=>{try{O("open-team")}catch(f){console.error("Error opening team dialog:",f),I.value="Failed to open team dialog"}},w=()=>{try{O("open-player")}catch(f){console.error("Error opening player dialog:",f),I.value="Failed to open player dialog"}},h=()=>{try{O("open-update-player")}catch(f){console.error("Error opening update player dialog:",f),I.value="Failed to open update player dialog"}};return(f,l)=>(C(),Q("div",Ee,[L("div",$e,[L("div",De,[L("div",Ne,[s(j,{class:"action-btn","prepend-icon":"mdi-tournament",onClick:R},{default:d(()=>l[0]||(l[0]=[D(" Add Tournament ")])),_:1}),s(j,{class:"action-btn","prepend-icon":"mdi-account-group",onClick:U},{default:d(()=>l[1]||(l[1]=[D(" Add Team ")])),_:1})]),L("div",Se,[s(j,{class:"action-btn","prepend-icon":"mdi-account",onClick:w},{default:d(()=>l[2]||(l[2]=[D(" Add Player ")])),_:1}),s(j,{class:"action-btn","prepend-icon":"mdi-account-edit",onClick:h},{default:d(()=>l[3]||(l[3]=[D(" Update Player ")])),_:1})])]),I.value?(C(),Q("div",Le,te(I.value),1)):le("",!0)])]))}}),na=ne(Ie,[["__scopeId","data-v-8f86e91a"]]),ze={class:"dialog-content"},qe={class:"d-flex align-center"},je=oe({__name:"AddTournamentDialog",props:{modelValue:Boolean},emits:["update:modelValue","tournament-added"],setup(G,{emit:H}){const I=ue(),O=G,R=H,U=B({get:()=>O.modelValue,set:e=>R("update:modelValue",e)}),w=r(null),h=r(!1),f=r(""),l=r(""),y=r(""),p=r(""),V=r(Array(8).fill(null)),k=r([]),q=r(Array(8).fill("")),A=r(Array(8).fill(!1)),N=r(Array(8).fill("")),S=r(1),v=r(!1),c=r(null),b=r(""),F=r(""),E=r(""),_={required:e=>!!e||"This field is required",minLength:e=>e.length>=3||"Title must be at least 3 characters",minPrize:e=>e>=1||"Prize pool must be at least 1 Kitty Kibble"},P=[{title:"Single Elimination",value:"single elimination"},{title:"Round Robin",value:"round robin"},{title:"One-Off Match",value:"one off match"}],Z=()=>{S.value=1,f.value="",l.value="",y.value="",p.value="",V.value=Array(8).fill(null),q.value=Array(8).fill(""),A.value=Array(8).fill(!1),N.value=Array(8).fill(""),b.value="",F.value="",E.value=""},J=B(()=>({"single elimination":8,"round robin":5,"one off match":2})[l.value]||0),X=B(()=>f.value.length>=3&&l.value&&y.value&&p.value>=1),Y=B(()=>{const e={"single elimination":4,"round robin":4,"one off match":2};return V.value.reduce((n,T,u)=>{var z;return A.value[u]?(z=N.value[u])!=null&&z.trim()?n+1:n:T?n+1:n},0)>=e[l.value]}),re=e=>k.value.filter(i=>!V.value.some((n,T)=>n===i.id&&T!==e)),W=e=>l.value==="single elimination"?e<4?[_.required]:[]:l.value==="round robin"?e<4?[_.required]:[]:l.value==="one off match"?e<2?[_.required]:[]:[],o=e=>{A.value[e]=!A.value[e],A.value[e]?V.value[e]=null:N.value[e]=""},m=()=>{U.value=!1,Z()},g=async()=>{if(!c.value)return;F.value="",E.value="",b.value="";let e=!1;try{(await(await fetch(`${K}/tournaments?search=${encodeURIComponent(f.value)}`)).json()).some(ee=>ee.title.toLowerCase()===f.value.toLowerCase())&&(F.value="A tournament with this name already exists",e=!0)}catch(z){console.error("Error checking tournament title:",z)}const i=new Date(y.value),n=new Date;if(n.setDate(n.getDate()+1),n.setHours(i.getHours(),i.getMinutes(),i.getSeconds()),i<new Date&&(E.value="Tournament start date cannot be in the past",e=!0),i<=n&&(E.value="Start date must be at least 1 day in the future",e=!0),e)return;try{v.value=!0;const z=await fetch(`${K}/teams?is_available=true&offset=0&limit=100`);if(!z.ok)throw new Error("Failed to load teams");const M=await z.json();k.value=M}catch(z){console.error("Error fetching teams:",z),b.value="Failed to load teams. Please try again.";return}finally{v.value=!1}const{valid:u}=await c.value.validate();u&&(S.value=2)},a=async()=>{if(console.log("Starting tournament submission..."),!w.value)return;const{valid:e}=await w.value.validate();if(e)try{h.value=!0,b.value="";const i=new Date(y.value).toISOString(),n=V.value.map((M,ee)=>{if(A.value[ee])return N.value[ee];const ae=k.value.find(Te=>Te.id===M);return(ae==null?void 0:ae.name)||""}).filter(M=>M!=="");console.log("Final team names for submission:",n);const T=new URLSearchParams({title:f.value,tournament_format:l.value,start_date:i,prize_pool:p.value.toString()}),u=await fetch(`${K}/tournaments/?${T.toString()}`,{method:"POST",headers:{Authorization:`Bearer ${I.token}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!u.ok){const M=await u.json();if(M.detail&&Array.isArray(M.detail)){const ee=M.detail.map(ae=>`${ae.msg} (${ae.loc.join(".")})`);throw new Error(ee.join(`
`))}else throw new Error(M.detail||"Unknown error occurred")}U.value=!1;const z=await u.json();R("tournament-added",z),Z()}catch(i){console.error("Full error:",i),b.value=i.message}finally{h.value=!1}},t=async()=>{try{v.value=!0;const e=await fetch(`${K}/teams?is_available=true&offset=0&limit=100`);if(!e.ok)throw new Error("Failed to fetch teams");k.value=await e.json()}catch(e){console.error("Error fetching teams:",e)}finally{v.value=!1}};return ye(async()=>{await t()}),(e,i)=>(C(),$(fe,{modelValue:U.value,"onUpdate:modelValue":i[4]||(i[4]=n=>U.value=n),"max-width":"500"},{default:d(()=>[s(me,{class:"dialog-card"},{default:d(()=>[L("div",ze,[s(ie,{class:"dialog-title"},{default:d(()=>[L("span",null,te(S.value===1?"Tournament Details":"Select Teams"),1)]),_:1}),s(se,null,{default:d(()=>[b.value?(C(),$(Ue,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4"},{default:d(()=>[D(te(b.value),1)]),_:1})):le("",!0),S.value===1?(C(),$(pe,{key:1,ref_key:"form",ref:c},{default:d(()=>[s(x,{modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=n=>f.value=n),label:"Tournament Title",variant:"outlined",rules:[_.required,_.minLength],"error-messages":F.value},null,8,["modelValue","rules","error-messages"]),s(Fe,{modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=n=>l.value=n),items:P,label:"Tournament Format",variant:"outlined",rules:[_.required],class:"format-select"},null,8,["modelValue","rules"]),s(x,{modelValue:y.value,"onUpdate:modelValue":i[2]||(i[2]=n=>y.value=n),label:"Start Date",type:"datetime-local",variant:"outlined",rules:[_.required],"error-messages":E.value},null,8,["modelValue","rules","error-messages"]),s(x,{modelValue:p.value,"onUpdate:modelValue":i[3]||(i[3]=n=>p.value=n),label:"Prize Pool (Kitty Kibbles)",variant:"outlined",type:"number",rules:[_.required,_.minPrize]},null,8,["modelValue","rules"])]),_:1},512)):(C(),$(pe,{key:2,ref_key:"teamForm",ref:w},{default:d(()=>[(C(!0),Q(_e,null,ke(J.value,n=>(C(),Q("div",{class:"team-slot",key:n},[L("div",qe,[A.value[n-1]?(C(),$(x,{key:1,modelValue:N.value[n-1],"onUpdate:modelValue":T=>N.value[n-1]=T,label:`Custom Team ${n}`,variant:"outlined",class:"flex-grow-1",rules:W(n-1)},null,8,["modelValue","onUpdate:modelValue","label","rules"])):(C(),$(we,{key:0,modelValue:V.value[n-1],"onUpdate:modelValue":T=>V.value[n-1]=T,items:re(n-1),"item-title":"name","item-value":"id",label:`Team ${n}`,variant:"outlined",loading:v.value,clearable:"",class:"flex-grow-1 custom-autocomplete",rules:W(n-1)},{item:d(({props:T,item:u})=>[s(ge,he({ref_for:!0},T,{title:u.raw.name,class:"team-list-item"}),null,16,["title"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","label","loading","rules"])),s(j,{icon:"",class:"custom-toggle-btn ml-2",onClick:T=>o(n-1),title:A.value[n-1]?"Switch to existing teams":"Add custom team",variant:"outlined"},{default:d(()=>[s(ce,{size:"20"},{default:d(()=>[D(te(A.value[n-1]?"mdi-format-list-bulleted":"mdi-plus"),1)]),_:2},1024)]),_:2},1032,["onClick","title"])])]))),128))]),_:1},512))]),_:1}),s(de,null,{default:d(()=>[s(ve),s(j,{class:"cancel-btn",onClick:m},{default:d(()=>i[5]||(i[5]=[D(" Cancel ")])),_:1}),S.value===1?(C(),$(j,{key:0,class:"next-btn",onClick:g,disabled:!X.value},{default:d(()=>i[6]||(i[6]=[D(" Next ")])),_:1},8,["disabled"])):(C(),$(j,{key:1,class:"submit-btn",onClick:a,loading:h.value,disabled:!Y.value},{default:d(()=>i[7]||(i[7]=[D(" Create Tournament ")])),_:1},8,["loading","disabled"]))]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),ua=ne(je,[["__scopeId","data-v-a1e22cb7"]]),Re={class:"dialog-content"},xe={class:"file-upload-section"},Oe=oe({__name:"AddTeamDialog",props:{modelValue:Boolean},emits:["update:modelValue","team-added"],setup(G,{emit:H}){const I=ue(),O=G,R=H,U=B({get:()=>O.modelValue,set:v=>R("update:modelValue",v)}),w=B(()=>f.value?!V.team.every(v=>{const c=v(f.value);return typeof c=="boolean"?c:!1}):!0),h=r(!1),f=r(""),l=r(null),y=r(null),p=r(""),V={team:[v=>!!v||"Team name is required",v=>v.length>=5||"Team name must be at least 5 characters",v=>v.length<=50||"Team name must not exceed 50 characters",v=>/^[a-zA-Z0-9\s-]+$/.test(v)||"Team name can only contain letters, numbers, spaces and dashes"]},k=()=>{l.value=null,y.value=null},q=()=>{N(),U.value=!1},A=v=>{let c=null;if(Array.isArray(v)?c=v[0]:v instanceof File?c=v:(v==null?void 0:v.target)instanceof HTMLInputElement&&v.target.files&&(c=v.target.files[0]),c){const b=new FileReader;b.onload=F=>{y.value=F.target.result},b.readAsDataURL(c),l.value=c}else y.value=null,l.value=null},N=()=>{f.value="",l.value=null,y.value=null,p.value=""},S=async()=>{var v;try{if(h.value=!0,p.value="",!((v=f.value)!=null&&v.trim())){p.value="Team name is required";return}if(f.value.length<3){p.value="Team name must be at least 3 characters long";return}const c=new URLSearchParams({name:f.value.trim()});let b={Authorization:`Bearer ${I.token}`},F;if(l.value){const P=new FormData;P.append("logo",l.value),F=P}else b["Content-Type"]="application/json",F=JSON.stringify({logo:null});const E=await fetch(`${K}/teams/?${c.toString()}`,{method:"POST",headers:b,body:F});if(!E.ok){const P=await E.json();P.detail?Array.isArray(P.detail)?p.value=P.detail[0].msg||"Invalid team data":p.value=P.detail:p.value="Failed to create team";return}U.value=!1;const _=await E.json();R("team-added",_),N()}catch(c){console.error("Error creating team:",c),p.value="Failed to connect to server. Please try again."}finally{h.value=!1}};return(v,c)=>(C(),$(fe,{modelValue:U.value,"onUpdate:modelValue":c[3]||(c[3]=b=>U.value=b),"max-width":"450"},{default:d(()=>[s(me,{class:"dialog-card"},{default:d(()=>[L("div",Re,[s(ie,{class:"dialog-title"},{default:d(()=>c[4]||(c[4]=[L("span",null,"Add New Team",-1)])),_:1}),s(se,null,{default:d(()=>[L("div",xe,[s(Ve,{size:"120",class:"preview-avatar"},{default:d(()=>[y.value?(C(),$(be,{key:0,src:y.value,alt:"Team logo"},null,8,["src"])):(C(),$(ce,{key:1,icon:"mdi-shield",color:"#42DDF2FF",size:"48"}))]),_:1}),s(Ae,{modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=b=>l.value=b),label:"Team Logo",variant:"outlined",accept:"image/*","show-size":!0,"prepend-icon":"mdi-camera",class:"upload-input",onChange:A,"onClick:clear":k,"hide-details":""},null,8,["modelValue"])]),s(x,{modelValue:f.value,"onUpdate:modelValue":[c[1]||(c[1]=b=>f.value=b),c[2]||(c[2]=b=>p.value="")],label:"Team Name",variant:"outlined",rules:V.team,"error-messages":p.value,onKeyup:Ce(S,["enter"])},null,8,["modelValue","rules","error-messages"])]),_:1}),s(de,{class:"dialog-actions"},{default:d(()=>[s(ve),s(j,{class:"cancel-btn",variant:"text",onClick:q},{default:d(()=>c[5]||(c[5]=[D(" Cancel ")])),_:1}),s(j,{class:"submit-btn",onClick:S,loading:h.value,disabled:!f.value||w.value},{default:d(()=>c[6]||(c[6]=[D(" Create Team ")])),_:1},8,["loading","disabled"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),ia=ne(Oe,[["__scopeId","data-v-cf47c087"]]),Be={class:"dialog-content"},Ze={key:0,class:"input-wrapper"},Me={key:1},Ke={class:"player-status mb-4 text-center"},He={class:"file-upload-section"},Je={key:0,class:"text-center linked-player-message"},Ge=oe({__name:"UpdatePlayerDialog",props:{modelValue:Boolean},emits:["update:modelValue","player-updated"],setup(G,{emit:H}){const I=ue(),O=G,R=H,U=B({get:()=>O.modelValue,set:a=>R("update:modelValue",a)}),w=r(""),h=r(""),f=r(!1),l=r(null),y=r(""),p=r(""),V=r(""),k=r(null),q=r(null),A=r(""),N=r(!1),S=r(!1),v=r([]);r(""),r(!1);const c=r(""),b=r(""),F=r(""),E=r(""),_={required:a=>!!a||"This field is required",username:[a=>!!a||"Username is required",a=>a.length>=5||"Username must be at least 5 characters",a=>a.length<=15||"Username must not exceed 15 characters",a=>/^[a-zA-Z0-9_-]+$/.test(a)||"Username can only contain letters, numbers, underscores, or dashes"],firstName:[a=>!!a||"First name is required",a=>a.length>=2||"First name must be at least 2 characters",a=>a.length<=25||"First name must not exceed 25 characters",a=>/^[a-zA-Z]+(?:[-a-zA-Z]+)?$/.test(a)||"Invalid first name format"],lastName:[a=>!!a||"Last name is required",a=>a.length>=2||"Last name must be at least 2 characters",a=>a.length<=25||"Last name must not exceed 25 characters",a=>/^[a-zA-Z]+(?:[-a-zA-Z]+)?$/.test(a)||"Invalid last name format"],country:[a=>!!a||"Country is required",a=>a.length>=2||"Country must be at least 2 characters",a=>a.length<=25||"Country must not exceed 25 characters",a=>/^[a-zA-Z]+(?:[\s-][a-zA-Z]+)*$/.test(a)||"Invalid country format"]},P=B(()=>{const a=!w.value||!y.value||!p.value||!V.value,t=w.value&&!_.username.every(T=>T(w.value)===!0),e=y.value&&!_.firstName.every(T=>T(y.value)===!0),i=p.value&&!_.lastName.every(T=>T(p.value)===!0),n=V.value&&!_.country.every(T=>T(V.value)===!0);return a||t||e||i||n}),Z=B(()=>{if(!l.value)return!1;const a=w.value!==l.value.username||y.value!==l.value.first_name||p.value!==l.value.last_name||V.value!==l.value.country||A.value!==(l.value.team_name||""),t=k.value!==null;return(a||t)&&!P.value}),J=()=>{c.value="",b.value="",F.value="",E.value=""},X=a=>{let t=null;if(Array.isArray(a)?t=a[0]:a instanceof File?t=a:(a==null?void 0:a.target)instanceof HTMLInputElement&&a.target.files&&(t=a.target.files[0]),t){const e=new FileReader;e.onload=i=>{q.value=i.target.result},e.readAsDataURL(t),k.value=t}else q.value=null,k.value=null},Y=async(a,t)=>{if(l.value)try{h.value="";const e=new URLSearchParams;e.append(a,t);const i=await fetch(`${K}/players/${l.value.id}?${e.toString()}`,{method:"PUT",headers:{Authorization:`Bearer ${I.token}`}});if(!i.ok){const n=await i.json();handleError(n);return}l.value={...l.value,[a]:t}}catch(e){console.error(`Error updating ${a}:`,e),h.value="Failed to update player"}},re=a=>{Y("team_id",a)},W=async()=>{var a;if(h.value="",!((a=w.value)!=null&&a.trim())){h.value="Username is required";return}try{f.value=!0,h.value="";const i=(await(await fetch(`${K}/players?search=${encodeURIComponent(w.value)}`)).json()).find(n=>n.username.toLowerCase()===w.value.toLowerCase());if(!i){h.value="Player not found.";return}l.value=i,l.value.user_email||(y.value=l.value.first_name||"",p.value=l.value.last_name||"",V.value=l.value.country||"",w.value=l.value.username||"",A.value=l.value.team_name||"",l.value.avatar&&(q.value=l.value.avatar),v.value.length===0&&await m())}catch(t){console.error("Error checking player:",t),h.value="Failed to check player"}finally{f.value=!1}},o=async()=>{if(!l.value){h.value="No player selected";return}try{if(J(),N.value=!0,h.value="",w.value&&!_.username.every(u=>u(w.value)===!0)){c.value="Invalid username format";return}if(y.value&&!_.firstName.every(u=>u(y.value)===!0)){b.value="Invalid first name format";return}if(p.value&&!_.lastName.every(u=>u(p.value)===!0)){F.value="Invalid last name format";return}if(V.value&&!_.country.every(u=>u(V.value)===!0)){E.value="Invalid country format";return}let a=`${K}/players/${l.value.id}`;const t=new URLSearchParams;if(w.value!==l.value.username&&t.append("username",w.value),y.value!==l.value.first_name&&t.append("first_name",y.value),p.value!==l.value.last_name&&t.append("last_name",p.value),V.value!==l.value.country&&t.append("country",V.value),l.value.team_id&&A.value===""||A.value&&A.value!==l.value.team_id)if(A.value==="")t.append("team_name","");else{const u=v.value.find(z=>z.id===A.value);u&&t.append("team_name",u.name)}t.toString()&&(a+="?"+t.toString());let e={Authorization:`Bearer ${I.token}`},i;if(k.value){const u=new FormData;u.append("avatar",k.value),i=u}else e["Content-Type"]="application/json",i=JSON.stringify({avatar:null});const n=await fetch(a,{method:"PUT",headers:{Authorization:`Bearer ${I.token}`},body:i});if(!n.ok){const u=await n.json();if(console.log("Error updating player:",u),u.detail&&typeof u.detail=="string"){if(u.detail.includes("username"))c.value=u.detail;else if(u.detail.includes("first_name"))b.value=u.detail;else if(u.detail.includes("last_name"))F.value=u.detail;else if(u.detail.includes("country"))E.value=u.detail;else throw new Error(u.detail);return}throw new Error(u.detail||"Failed to update player")}U.value=!1;const T=await n.json();R("player-updated",T),g()}catch(a){console.error("Error updating player:",a),h.value=a.message||"Failed to connect to server. Please try again."}finally{N.value=!1}},m=async()=>{try{S.value=!0;const a=await fetch(`${K}/teams?has_space=true&offset=0&limit=100`);if(!a.ok)throw new Error("Failed to fetch teams");const t=await a.json();v.value=t}catch(a){console.error("Error fetching teams:",a)}finally{S.value=!1}},g=()=>{U.value=!1,w.value="",h.value="",l.value=null,y.value="",p.value="",V.value="",k.value=null,A.value="",q.value&&URL.revokeObjectURL(q.value),q.value=null};return ye(async()=>{m()}),(a,t)=>(C(),$(fe,{modelValue:U.value,"onUpdate:modelValue":t[8]||(t[8]=e=>U.value=e),"max-width":"450"},{default:d(()=>[s(me,{class:"dialog-card"},{default:d(()=>[L("div",Be,[s(ie,{class:"dialog-title"},{default:d(()=>t[9]||(t[9]=[L("span",null,"Update Player",-1)])),_:1}),s(se,null,{default:d(()=>[l.value?(C(),Q("div",Me,[L("div",Ke,[s(Pe,{color:l.value.user_email?"error":"success",class:"status-chip"},{default:d(()=>[D(te(l.value.user_email?"Linked to User":"Available for Update"),1)]),_:1},8,["color"])]),l.value.user_email?le("",!0):(C(),Q(_e,{key:0},[L("div",He,[s(Ve,{size:"120",class:"preview-avatar"},{default:d(()=>[q.value||l.value.avatar?(C(),$(be,{key:0,src:q.value||l.value.avatar,alt:"Player avatar"},null,8,["src"])):(C(),$(ce,{key:1,icon:"mdi-account",color:"#42DDF2FF",size:"48"}))]),_:1}),s(Ae,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=e=>k.value=e),label:"Player Avatar (Optional)",variant:"outlined",accept:"image/*","prepend-icon":"mdi-camera","show-size":!0,class:"upload-input",onChange:X,"hide-details":""},null,8,["modelValue"])]),s(x,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e),label:"Username",variant:"outlined",rules:_.username,"error-messages":c.value,onInput:J},null,8,["modelValue","rules","error-messages"]),s(x,{modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=e=>y.value=e),label:"First Name",variant:"outlined",rules:_.firstName,"error-messages":b.value,onInput:J},null,8,["modelValue","rules","error-messages"]),s(x,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=e=>p.value=e),label:"Last Name",variant:"outlined",rules:_.lastName,"error-messages":F.value,onInput:J},null,8,["modelValue","rules","error-messages"]),s(x,{modelValue:V.value,"onUpdate:modelValue":t[6]||(t[6]=e=>V.value=e),label:"Country",variant:"outlined",rules:_.country,"error-messages":E.value,onInput:J},null,8,["modelValue","rules","error-messages"]),s(we,{modelValue:A.value,"onUpdate:modelValue":[t[7]||(t[7]=e=>A.value=e),re],items:v.value,"item-title":"name","item-value":"name",label:"Team",variant:"outlined",loading:S.value,clearable:"","menu-props":{contentClass:"teams-menu"},"return-object":!1,"model-value":A.value},{item:d(({props:e,item:i})=>[s(ge,he(e,{title:i.raw.name,class:"team-list-item"}),null,16,["title"])]),_:1},8,["modelValue","items","loading","model-value"])],64)),s(se,null,{default:d(()=>{var e;return[(e=l.value)!=null&&e.user_email?(C(),Q("div",Je," This player is linked to a user and cannot be updated. ")):le("",!0)]}),_:1})])):(C(),Q("div",Ze,[s(x,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),label:"Player Username",variant:"outlined",rules:[_.required],"error-messages":h.value,onKeyup:Ce(W,["enter"]),onInput:t[1]||(t[1]=e=>h.value="")},null,8,["modelValue","rules","error-messages"])]))]),_:1}),s(de,{class:"dialog-actions"},{default:d(()=>[s(ve),s(j,{class:"cancel-btn",variant:"text",onClick:g},{default:d(()=>t[10]||(t[10]=[D(" Cancel ")])),_:1}),l.value?le("",!0):(C(),$(j,{key:0,class:"next-btn",onClick:W,loading:f.value,disabled:!w.value},{default:d(()=>t[11]||(t[11]=[D(" Next ")])),_:1},8,["loading","disabled"])),l.value&&!l.value.user_email?(C(),$(j,{key:1,class:"submit-btn",onClick:o,loading:N.value,disabled:!Z.value},{default:d(()=>[D(te(Z.value?"Update Player":"No Changes"),1)]),_:1},8,["loading","disabled"])):le("",!0)]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),da=ne(Ge,[["__scopeId","data-v-4752be7c"]]),Qe={class:"dialog-content"},We={class:"file-upload-section"},Xe=oe({__name:"AddPlayerDialog",props:{modelValue:Boolean},emits:["update:modelValue","player-added"],setup(G,{emit:H}){const I=ue(),O=G,R=H,U=B({get:()=>O.modelValue,set:o=>R("update:modelValue",o)}),w=B(()=>{const o=!P.username.every(t=>{const e=t(l.value);return typeof e=="boolean"?e:!1}),m=!P.firstName.every(t=>{const e=t(y.value);return typeof e=="boolean"?e:!1}),g=!P.lastName.every(t=>{const e=t(p.value);return typeof e=="boolean"?e:!1}),a=!P.country.every(t=>{const e=t(V.value);return typeof e=="boolean"?e:!1});return o||m||g||a}),h=r(null),f=r(null),l=r(""),y=r(""),p=r(""),V=r(""),k=r(null),q=r(!1),A=r(!1),N=r(!1),S=r([]),v=r(null);r(""),r(!1);const c=r(""),b=r(""),F=r(""),E=r(""),_=B(()=>l.value.trim()&&y.value.trim()&&p.value.trim()&&V.value.trim()&&!c.value&&!b.value&&!F.value&&!E.value),P={username:[o=>!!o||"Username is required",o=>o.length>=5||"Username must be at least 5 characters",o=>o.length<=15||"Username must not exceed 15 characters",o=>/^[a-zA-Z0-9_-]+$/.test(o)||"Username can only contain letters, numbers, underscores, or dashes"],firstName:[o=>!!o||"First name is required",o=>o.length>=2||"First name must be at least 2 characters",o=>o.length<=25||"First name must not exceed 25 characters",o=>/^[a-zA-Z]+(?:[-a-zA-Z]+)?$/.test(o)||"Invalid first name format"],lastName:[o=>!!o||"Last name is required",o=>o.length>=2||"Last name must be at least 2 characters",o=>o.length<=25||"Last name must not exceed 25 characters",o=>/^[a-zA-Z]+(?:[-a-zA-Z]+)?$/.test(o)||"Invalid last name format"],country:[o=>!!o||"Country is required",o=>o.length>=2||"Country must be at least 2 characters",o=>o.length<=25||"Country must not exceed 25 characters",o=>/^[a-zA-Z]+(?:[\s-][a-zA-Z]+)*$/.test(o)||"Invalid country format"]},Z=()=>{c.value="",b.value="",F.value="",E.value=""},J=o=>{let m=null;if(Array.isArray(o)?m=o[0]:o instanceof File?m=o:(o==null?void 0:o.target)instanceof HTMLInputElement&&o.target.files&&(m=o.target.files[0]),m){const g=new FileReader;g.onload=a=>{var t;f.value=(t=a.target)==null?void 0:t.result},g.readAsDataURL(m),h.value=m}else f.value=null,h.value=null},X=()=>{h.value=null,f.value&&URL.revokeObjectURL(f.value),f.value=null},Y=()=>{R("update:modelValue",!1),l.value="",y.value="",p.value="",V.value="",k.value=null,X(),Z()},re=async()=>{var m;const{valid:o}=await v.value.validate();if(o)try{A.value=!0;const g={username:l.value,first_name:y.value,last_name:p.value,country:V.value};if(k.value){const u=(m=S.value.find(z=>z.id===k.value))==null?void 0:m.name;u&&(g.team_name=u)}const a=new URLSearchParams(g);let t=`${K}/players/?${a.toString()}`,e={Authorization:`Bearer ${I.token}`},i;if(h.value){const u=new FormData;u.append("avatar",h.value),i=u}else e["Content-Type"]="application/json",i=JSON.stringify({avatar:null});const n=await fetch(t,{method:"POST",headers:e,body:i});if(!n.ok){const u=await n.json();if(u.detail)typeof u.detail=="string"&&(u.detail.includes("username")&&(c.value="Player with this username already exists"),u.detail.includes("first_name")&&(b.value="Invalid first name"),u.detail.includes("last_name")&&(F.value="Invalid last name"),u.detail.includes("country")&&(E.value="Invalid country"));else throw new Error(u.detail||"Failed to create player");return}U.value=!1;const T=await n.json();R("player-added",T),Y()}catch(g){console.error("Error adding player:",g.message)}finally{A.value=!1}},W=async()=>{try{N.value=!0;const o=await fetch(`${K}/teams?has_space=true&offset=0&limit=100`);if(!o.ok)throw new Error("Failed to fetch teams");const m=await o.json();S.value=m,console.log("Loaded teams:",S.value)}catch(o){console.error("Error fetching teams:",o)}finally{N.value=!1}};return ye(()=>{W()}),(o,m)=>(C(),$(fe,{modelValue:U.value,"onUpdate:modelValue":m[7]||(m[7]=g=>U.value=g),"max-width":"450"},{default:d(()=>[s(me,{class:"dialog-card"},{default:d(()=>[L("div",Qe,[s(ie,{class:"dialog-title"},{default:d(()=>m[8]||(m[8]=[L("span",null,"Add New Player",-1)])),_:1}),s(se,null,{default:d(()=>[L("div",We,[s(Ve,{size:"120",class:"preview-avatar"},{default:d(()=>[f.value?(C(),$(be,{key:0,src:f.value,alt:"Player avatar"},null,8,["src"])):(C(),$(ce,{key:1,icon:"mdi-account",color:"#42DDF2FF",size:"48"}))]),_:1}),s(Ae,{modelValue:h.value,"onUpdate:modelValue":m[0]||(m[0]=g=>h.value=g),label:"Player Avatar (Optional)",variant:"outlined",accept:"image/*","show-size":!0,"prepend-icon":"mdi-camera",class:"upload-input",onChange:J,"onClick:clear":X,"hide-details":""},null,8,["modelValue"])]),s(pe,{ref_key:"addPlayerForm",ref:v,modelValue:q.value,"onUpdate:modelValue":m[5]||(m[5]=g=>q.value=g)},{default:d(()=>[s(x,{modelValue:l.value,"onUpdate:modelValue":m[1]||(m[1]=g=>l.value=g),label:"Username",variant:"outlined",rules:P.username,"error-messages":c.value,onInput:Z},null,8,["modelValue","rules","error-messages"]),s(x,{modelValue:y.value,"onUpdate:modelValue":m[2]||(m[2]=g=>y.value=g),label:"First Name",variant:"outlined",rules:P.firstName,"error-messages":b.value,onInput:Z},null,8,["modelValue","rules","error-messages"]),s(x,{modelValue:p.value,"onUpdate:modelValue":m[3]||(m[3]=g=>p.value=g),label:"Last Name",variant:"outlined",rules:P.lastName,"error-messages":F.value,onInput:Z},null,8,["modelValue","rules","error-messages"]),s(x,{modelValue:V.value,"onUpdate:modelValue":m[4]||(m[4]=g=>V.value=g),label:"Country",variant:"outlined",rules:P.country,"error-messages":E.value,onInput:Z},null,8,["modelValue","rules","error-messages"])]),_:1},8,["modelValue"]),s(we,{modelValue:k.value,"onUpdate:modelValue":m[6]||(m[6]=g=>k.value=g),items:S.value,"item-title":"name","item-value":"id",label:"Team (Optional)",variant:"outlined",loading:N.value,clearable:"","menu-props":{contentClass:"teams-menu"}},{item:d(({props:g,item:a})=>[s(ge,he(g,{title:a.title,class:"team-list-item"}),null,16,["title"])]),default:d(()=>[m[9]||(m[9]=D(" >"))]),_:1},8,["modelValue","items","loading"])]),_:1}),s(de,{class:"dialog-actions"},{default:d(()=>[s(ve),s(j,{class:"cancel-btn",variant:"text",onClick:Y},{default:d(()=>m[10]||(m[10]=[D(" Cancel ")])),_:1}),s(j,{class:"submit-btn",onClick:re,loading:A.value,disabled:!_.value||w.value},{default:d(()=>m[11]||(m[11]=[D(" Create Player ")])),_:1},8,["loading","disabled"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),ma=ne(Xe,[["__scopeId","data-v-88a026f5"]]);export{na as A,da as U,ua as a,ia as b,ma as c};
