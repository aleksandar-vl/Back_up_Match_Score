import{d as V,I as k,r as n,J as P,f as h,c as b,e as p,b as l,w as c,x as w,G as _,t as $,k as C,A as S,_ as R,m as D,h as E,K as A,n as B,L as x,z as U,D as F,o as L,V as T,F as I}from"./index-DD0chK9m.js";import{H as z}from"./HeaderSection-BqWuRDgu.js";import{D as H}from"./DashboardWelcome-CxMUSv8I.js";import{V as N}from"./VSpacer-DKUpOtpE.js";import{V as j}from"./VDialog-8pvQ3nO6.js";import{R as Y}from"./RequestHistory-Dl0JT4OF.js";import"./dialog-transition-ChtNxUt0.js";const G={class:"actions-card"},M={class:"actions-content"},O={class:"actions-buttons"},J={key:0,class:"error-message"},K=V({__name:"UserRequestButtons",props:{requests:{}},emits:["update-requests","show-player-dialog","show-success"],setup(q,{emit:f}){const y=q,r=f,m=k(),a=n(null),t=n(!1),i=P(()=>y.requests.some(u=>u.status==="pending"&&(u.request_type==="link user to player"||u.request_type==="promote user to director"))),g=async()=>{if(i.value){a.value="You already have a pending request.";return}try{if(t.value=!0,a.value=null,!(await fetch(`${S}/requests/directors/${m.userEmail}`,{method:"POST",headers:{Authorization:`Bearer ${m.token}`}})).ok)throw new Error("Failed to submit request");r("show-success","Director role request submitted successfully. An admin will review your request shortly."),r("update-requests")}catch(u){console.error("Error submitting director request:",u),a.value="Failed to submit request. Please try again."}finally{t.value=!1}},v=()=>{if(i.value){a.value="You already have a pending request.";return}r("show-player-dialog")};return(u,o)=>(h(),b("div",G,[o[3]||(o[3]=p("div",{class:"actions-background"},null,-1)),p("div",M,[o[2]||(o[2]=p("h3",{class:"section-title"},"Available Actions",-1)),p("div",O,[l(_,{class:"action-btn","prepend-icon":"mdi-shield-account",onClick:g,disabled:i.value},{default:c(()=>o[0]||(o[0]=[w(" Request Director Role ")])),_:1},8,["disabled"]),l(_,{class:"action-btn","prepend-icon":"mdi-account-plus",onClick:v,disabled:i.value},{default:c(()=>o[1]||(o[1]=[w(" Link Player Profile ")])),_:1},8,["disabled"])]),a.value?(h(),b("div",J,$(a.value),1)):C("",!0)])]))}}),W=R(K,[["__scopeId","data-v-2b1a105e"]]),Q={class:"dialog-content"},X={key:0,class:"error-message"},Z=V({__name:"LinkPlayerRequestDialog",props:{modelValue:{type:Boolean},hasPendingRequest:{type:Boolean}},emits:["update:modelValue","submit-success"],setup(q,{emit:f}){const y=k(),r=q,m=f,a=n(""),t=n(null),i=n(!1),g={required:e=>!!e||"This field is required"},v=P({get:()=>r.modelValue,set:e=>m("update:modelValue",e)}),u=()=>{a.value="",t.value=null,v.value=!1},o=async()=>{var e;if(console.log("Starting handleSubmit"),r.hasPendingRequest){t.value="You already have a pending request.";return}if(!a.value){t.value="Player username is required.";return}try{i.value=!0,t.value=null;const s=await fetch(`${S}/requests/players/${a.value}`,{method:"POST",headers:{Authorization:`Bearer ${y.token}`}}),d=await s.json();if(!s.ok){if(s.status===404)t.value=`Player with username "${a.value}" was not found.`;else if(s.status===400&&((e=d.detail)!=null&&e.includes("already linked")))t.value=`Player "${a.value}" is already linked to another user.`;else throw new Error("Failed to submit request");return}m("submit-success","Player link request submitted successfully. An admin will review your request shortly."),u()}catch(s){console.error("Error submitting player link request:",s),t.value="Failed to submit request. Please try again."}finally{i.value=!1}};return D(a,e=>{e&&t.value&&(t.value=null)}),D(()=>r.modelValue,e=>{console.log("Dialog visibility changed:",e)}),(e,s)=>(h(),E(j,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=d=>v.value=d),"max-width":"500"},{default:c(()=>[l(F,{class:"dialog-card"},{default:c(()=>[s[5]||(s[5]=p("div",{class:"dialog-background"},null,-1)),p("div",Q,[l(A,{class:"dialog-title"},{default:c(()=>s[2]||(s[2]=[p("span",null,"Link Player Profile",-1)])),_:1}),l(B,null,{default:c(()=>[l(x,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=d=>a.value=d),label:"Player Username",variant:"outlined",rules:[g.required],error:!!t.value,class:"player-username-input"},null,8,["modelValue","rules","error"]),t.value?(h(),b("div",X,$(t.value),1)):C("",!0)]),_:1}),l(U,null,{default:c(()=>[l(N),l(_,{class:"cancel-btn",onClick:u},{default:c(()=>s[3]||(s[3]=[w(" Cancel ")])),_:1}),l(_,{class:"submit-btn",onClick:o,loading:i.value,disabled:!!t.value||!a.value||i.value},{default:c(()=>s[4]||(s[4]=[w(" Submit ")])),_:1},8,["loading","disabled"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),ee=R(Z,[["__scopeId","data-v-70ce2c53"]]),se={class:"content-wrapper"},te=V({__name:"DashboardUser",setup(q){const f=k(),y=n(f.userEmail),r=n([]),m=n(!0),a=n(null),t=n(!1),i=n(!1),g=n(""),v=e=>{g.value=e,i.value=!0,o(),window.setTimeout(()=>{window.location.reload()},200)},u=P(()=>(r.value.filter(e=>e.status==="pending"),r.value.some(e=>e.status==="pending"&&(e.request_type==="link user to player"||e.request_type==="promote user to director")))),o=async()=>{try{m.value=!0,a.value=null;const e=await fetch(`${S}/requests/me?offset=0&limit=10`,{method:"GET",headers:{Authorization:`Bearer ${f.token}`}});if(!e.ok){const d=await e.json();throw new Error(d.message||"Failed to fetch requests")}const s=await e.json();r.value=[...s]}catch(e){console.error("Error fetching requests:",e),a.value=e.message||"Failed to load request history. Please try again later."}finally{m.value=!1}};return L(()=>{o()}),(e,s)=>(h(),b(I,null,[l(z),p("div",se,[l(T,null,{default:c(()=>[l(H,{userRole:y.value},null,8,["userRole"]),l(W,{requests:r.value,onUpdateRequests:o,onShowPlayerDialog:s[0]||(s[0]=d=>t.value=!0),onShowSuccess:v},null,8,["requests"]),l(ee,{modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=d=>t.value=d),"has-pending-request":u.value,onSubmitSuccess:v},null,8,["modelValue","has-pending-request"]),l(Y)]),_:1})])],64))}}),de=R(te,[["__scopeId","data-v-393da68e"]]);export{de as default};
