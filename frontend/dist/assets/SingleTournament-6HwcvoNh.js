import{d as q,f as d,c as k,e as s,x as T,t as g,h as V,k as F,b as a,v as w,C as W,_ as N,N as Ve,w as i,l as le,F as L,i as O,g as ce,j as Te,M as ie,p as H,s as J,q as x,u as j,y as de,B as ue,r as h,J as S,m as B,K as Q,n as X,L as Y,z as Z,G as R,D as ee,I as we,o as De,al as Ee,V as ze,am as Ce,A}from"./index-DD0chK9m.js";import{M as Me}from"./MatchModalDialog-B5BSXzHQ.js";import{V as te}from"./VDialog-8pvQ3nO6.js";import{V as ae}from"./VSpacer-DKUpOtpE.js";import"./VAlert-BswZB0pH.js";import"./VForm-D4HHFwdz.js";import"./VAutocomplete-CIS9KaFs.js";import"./VSelect-BpGEebQz.js";import"./dialog-transition-ChtNxUt0.js";const $e="/assets/single-elimination-W8-QUgrI.png",Pe="/assets/round-robin-CAdXLt9V.png",be="/assets/one-off-match-DUlp02yC.png",Fe={class:"tournament-header-card"},Ue={class:"tournament-title-section"},Ae={class:"tournament-title"},Se={class:"format-tag"},Be={class:"tournament-dates"},Ie={class:"stage-indicator"},xe=q({__name:"TournamentHeader",props:{tournament:{},canEdit:{type:Boolean}},emits:["openTitleEdit","openEndDateEdit"],setup(U,{emit:$}){const c=$,z=u=>u.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "),t=(u,r)=>`${W(new Date(u),"dd MMM yyyy")} - ${W(new Date(r),"dd MMM yyyy")}`,f=u=>u==="finished"?"Tournament Completed":u==="final"?"Finals":u.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "),D=()=>{c("openTitleEdit")},_=()=>{c("openEndDateEdit")};return(u,r)=>(d(),k("div",Fe,[s("div",Ue,[s("h1",Ae,[T(g(u.tournament.title)+" ",1),u.canEdit?(d(),V(w,{key:0,icon:"mdi-pencil",class:"edit-icon ml-2",onClick:D})):F("",!0)]),s("div",Se,g(z(u.tournament.tournament_format.toUpperCase())),1)]),s("div",Be,[a(w,{icon:"mdi-calendar",class:"mr-2"}),T(" "+g(t(u.tournament.start_date,u.tournament.end_date))+" ",1),u.canEdit?(d(),V(w,{key:0,icon:"mdi-pencil",class:"edit-icon ml-2",onClick:_})):F("",!0)]),s("div",Ie,[a(w,{icon:"mdi-flag-checkered",class:"mr-2"}),T(" Current Stage: "+g(f(u.tournament.current_stage)),1)])]))}}),je=N(xe,[["__scopeId","data-v-25a98654"]]),Re={class:"tournament-content-wrapper"},qe={class:"prizes-card"},Ne={class:"section-title"},Le={class:"prizes-list"},Oe={class:"prize-details"},He={class:"prize-place"},Je={class:"prize-amount"},Ke={class:"teams-card"},We={class:"section-title"},Ge={class:"teams-list"},Qe={class:"team-name"},Xe={class:"brackets-card"},Ye={key:0,class:"stage-header"},Ze={class:"section-title"},et={class:"brackets-content"},tt={key:0,class:"stage-section current-stage"},at={class:"matches-grid"},ot=["onClick"],st={class:"match-content"},nt={class:"match-layout"},rt={class:"team-left"},lt={class:"team-score"},it={class:"team-right"},dt={class:"team-score"},ut={class:"match-footer"},ct={class:"match-time"},mt={class:"time-text"},pt={class:"match-winner"},vt={key:0,class:"winner-text"},_t={key:1,class:"winner-text pending"},ft={key:1,class:"past-matches-section"},ht={class:"section-title"},gt={class:"stage-subtitle"},yt={class:"matches-grid"},kt=["onClick"],Vt={class:"match-content"},Tt={class:"match-layout"},wt={class:"team-left"},Dt={class:"team-score"},Et={class:"team-right"},zt={class:"team-score"},Ct={class:"match-footer"},Mt={class:"match-time"},$t={class:"time-text"},Pt={key:0,class:"match-winner"},bt={class:"winner-text"},Ft={key:2,class:"loading-state"},Ut=q({__name:"TournamentContent",props:{tournament:{},pastMatches:{},isPastMatchesLoading:{type:Boolean},canEdit:{type:Boolean}},emits:["openPrizeEdit","openMatchDialog"],setup(U,{emit:$}){const c=$,z=r=>r===1?"1st":r===2?"2nd":`${r}th`,t=r=>r==="finished"?"Tournament Completed":r==="final"?"Finals":r.split("_").map(v=>v.charAt(0).toUpperCase()+v.slice(1)).join(" "),f=r=>[...new Set(r.map(v=>v.stage))].sort((v,M)=>{const l={group_stage:1,quarter_finals:2,semi_finals:3,final:4};return(l[v]||99)-(l[M]||99)}),D=(r,v)=>r.filter(M=>M.stage===v),_=()=>{c("openPrizeEdit")},u=r=>{c("openMatchDialog",r)};return(r,v)=>{const M=Ve("router-link");return d(),k("div",Re,[a(Te,{class:"mt-6"},{default:i(()=>[a(le,{cols:"12",md:"4"},{default:i(()=>[s("div",qe,[s("h3",Ne,[a(w,{icon:"mdi-cat",class:"mr-2"}),v[0]||(v[0]=T(" Prizes ")),r.canEdit?(d(),V(w,{key:0,icon:"mdi-pencil",class:"edit-icon ml-2",onClick:_})):F("",!0)]),s("div",Le,[(d(!0),k(L,null,O(r.tournament.prizes,l=>(d(),k("div",{key:l.id,class:"prize-item"},[s("div",{class:ie(["prize-trophy",{gold:l.place===1,silver:l.place===2}])},[a(w,{icon:l.place===1?"mdi-trophy":"mdi-trophy-variant",size:"32"},null,8,["icon"])],2),s("div",Oe,[s("span",He,g(z(l.place))+" place",1),s("span",Je,g(l.prize_cut)+" kitty kibbles",1)]),a(H,{location:"top"},{activator:i(({props:e})=>[l.team_id?(d(),V(M,J({key:0,to:`/teams/${l.team_id}`,class:"winner-team",ref_for:!0},e),{default:i(()=>[a(x,{size:"50",class:"prize-avatar"},{default:i(()=>[l.team_logo?(d(),V(j,{key:0,src:l.team_logo,alt:"Winner team logo"},null,8,["src"])):(d(),V(w,{key:1,icon:"mdi-shield",color:"#42DDF2FF"}))]),_:2},1024)]),_:2},1040,["to"])):F("",!0)]),default:i(()=>[T(" "+g(l.team_name),1)]),_:2},1024)]))),128))])]),s("div",Ke,[s("h3",We,[a(w,{icon:"mdi-account-group",class:"mr-2"}),v[1]||(v[1]=T(" Participating Teams "))]),s("div",Ge,[(d(!0),k(L,null,O(r.tournament.teams,l=>(d(),V(M,{key:l.id,to:`/teams/${l.id}`,class:"team-item"},{default:i(()=>[a(x,{size:"40",class:"team-avatar"},{default:i(()=>[l.logo?(d(),V(j,{key:0,src:l.logo,alt:"Team logo"},null,8,["src"])):(d(),V(w,{key:1,icon:"mdi-shield",color:"#42DDF2FF"}))]),_:2},1024),s("span",Qe,g(l.name),1)]),_:2},1032,["to"]))),128))])])]),_:1}),a(le,{cols:"12",md:"8"},{default:i(()=>{var l;return[s("div",Xe,[r.tournament.current_stage!=="finished"?(d(),k("div",Ye,[s("h3",Ze,[a(w,{icon:"mdi-tournament",class:"mr-2"}),T(" "+g(t(r.tournament.current_stage)),1)])])):F("",!0),s("div",et,[(l=r.tournament.matches_of_current_stage)!=null&&l.length?(d(),k("div",tt,[v[3]||(v[3]=s("h5",{class:"stage-subtitle"},"Current Stage Matches",-1)),s("div",at,[(d(!0),k(L,null,O(r.tournament.matches_of_current_stage,e=>(d(),k("div",{key:e.id,class:ie(["match-card",{"match-finished":e.is_finished}]),onClick:o=>u(e)},[s("div",st,[s("div",nt,[s("div",rt,[a(H,{location:"top"},{activator:i(({props:o})=>[a(x,J({class:"team-avatar",size:"60",ref_for:!0},o),{default:i(()=>[e.team1_logo?(d(),V(j,{key:0,src:e.team1_logo,alt:e.team1_name},null,8,["src","alt"])):(d(),V(w,{key:1,icon:"mdi-account",color:"#42DDF2FF",size:"40"}))]),_:2},1040)]),default:i(()=>[T(" "+g(e.team1_name),1)]),_:2},1024),s("span",lt,g(e.team1_score),1)]),v[2]||(v[2]=s("div",{class:"score-divider"},":",-1)),s("div",it,[s("span",dt,g(e.team2_score),1),a(H,{location:"top"},{activator:i(({props:o})=>[a(x,J({class:"team-avatar",size:"60",ref_for:!0},o),{default:i(()=>[e.team2_logo?(d(),V(j,{key:0,src:e.team2_logo,alt:e.team2_name},null,8,["src","alt"])):(d(),V(w,{key:1,icon:"mdi-account",color:"#42DDF2FF",size:"40"}))]),_:2},1040)]),default:i(()=>[T(" "+g(e.team2_name),1)]),_:2},1024)])]),a(de,{class:"match-divider"}),s("div",ut,[s("div",ct,[a(w,{icon:"mdi-clock-outline",class:"mr-2 neon-text"}),s("span",mt,g(ue(W)(new Date(e.start_time),"HH:mm, dd MMM yyyy")),1)]),s("div",pt,[a(w,{icon:e.winner_id?"mdi-crown":"mdi-crown-outline",class:"winner-icon",color:e.winner_id?"#FED854FF":"#808080"},null,8,["icon","color"]),e.winner_id?(d(),k("span",vt,g(e.winner_id===e.team1_id?e.team1_name:e.team2_name),1)):(d(),k("span",_t," pending... "))])])])],10,ot))),128))])])):F("",!0),r.pastMatches.length?(d(),k("div",ft,[s("h5",ht,[a(w,{icon:"mdi-history",class:"mr-2"}),v[4]||(v[4]=T(" Previous Matches "))]),(d(!0),k(L,null,O(f(r.pastMatches),e=>(d(),k("div",{key:e,class:"stage-section"},[s("h6",gt,g(t(e)),1),s("div",yt,[(d(!0),k(L,null,O(D(r.pastMatches,e),o=>(d(),k("div",{key:o.id,class:"match-card past-match",onClick:P=>u(o)},[s("div",Vt,[s("div",Tt,[s("div",wt,[a(H,{location:"top"},{activator:i(({props:P})=>[a(x,J({class:"team-avatar",size:"60",ref_for:!0},P),{default:i(()=>[o.team1_logo?(d(),V(j,{key:0,src:o.team1_logo,alt:o.team1_name},null,8,["src","alt"])):(d(),V(w,{key:1,icon:"mdi-account",color:"#42DDF2FF",size:"40"}))]),_:2},1040)]),default:i(()=>[T(" "+g(o.team1_name),1)]),_:2},1024),s("span",Dt,g(o.team1_score),1)]),v[5]||(v[5]=s("div",{class:"score-divider"},":",-1)),s("div",Et,[s("span",zt,g(o.team2_score),1),a(H,{location:"top"},{activator:i(({props:P})=>[a(x,J({class:"team-avatar",size:"60",ref_for:!0},P),{default:i(()=>[o.team2_logo?(d(),V(j,{key:0,src:o.team2_logo,alt:o.team2_name},null,8,["src","alt"])):(d(),V(w,{key:1,icon:"mdi-account",color:"#42DDF2FF",size:"40"}))]),_:2},1040)]),default:i(()=>[T(" "+g(o.team2_name),1)]),_:2},1024)])]),a(de,{class:"match-divider"}),s("div",Ct,[s("div",Mt,[a(w,{icon:"mdi-clock-outline",class:"mr-2 neon-text"}),s("span",$t,g(ue(W)(new Date(o.start_time),"HH:mm, dd MMM yyyy")),1)]),o.winner_id?(d(),k("div",Pt,[a(w,{icon:"mdi-crown",color:"#fed854",size:"24"}),s("span",bt,g(o.winner_id===o.team1_id?o.team1_name:o.team2_name),1)])):F("",!0)])])],8,kt))),128))])]))),128))])):F("",!0),r.isPastMatchesLoading?(d(),k("div",Ft,[a(ce,{indeterminate:"",color:"#42DDF2FF"})])):F("",!0)])])]}),_:1})]),_:1})])}}}),At=N(Ut,[["__scopeId","data-v-502a826c"]]),St={class:"dialog-content"},Bt=q({__name:"TournamentTitleDialog",props:{modelValue:{type:Boolean},currentTitle:{},error:{}},emits:["update:modelValue","save"],setup(U,{emit:$}){const c=U,z=$,t=h(c.currentTitle),f=h(""),D={required:e=>!!(e!=null&&e.trim())||"Title is required",length:e=>{const o=(e==null?void 0:e.trim().length)||0;return o>=3&&o<=50||"Title must be between 3 and 50 characters"}},_=S(()=>{var o;const e=((o=t.value)==null?void 0:o.trim())||"";return D.required(e)===!0&&D.length(e)===!0}),u=S(()=>{var e,o;return((e=t.value)==null?void 0:e.trim())!==((o=c.currentTitle)==null?void 0:o.trim())});B(()=>c.modelValue,e=>{e&&(t.value=c.currentTitle,f.value="")}),B(()=>c.currentTitle,e=>{c.modelValue&&(t.value=e)}),B(()=>c.error,e=>{e&&(f.value=e)});const r=()=>{t.value=c.currentTitle,f.value=""},v=()=>{r(),z("update:modelValue",!1)},M=e=>{e||r(),z("update:modelValue",e)},l=()=>{var o;const e=(o=t.value)==null?void 0:o.trim();if(!_.value){f.value=e?"Title must be between 3 and 50 characters":"Title is required";return}z("save",e)};return(e,o)=>(d(),V(te,{modelValue:e.modelValue,"onUpdate:modelValue":M,"max-width":"500px",class:"title-dialog"},{default:i(()=>[a(ee,{class:"dialog-card"},{default:i(()=>[s("div",St,[a(Q,{class:"dialog-title"},{default:i(()=>o[1]||(o[1]=[T("Edit Tournament Title")])),_:1}),a(X,null,{default:i(()=>[a(Y,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=P=>t.value=P),label:"Tournament Title",variant:"outlined",rules:[D.required,D.length],error:!!f.value,"error-messages":f.value},null,8,["modelValue","rules","error","error-messages"])]),_:1}),a(Z,{class:"dialog-actions"},{default:i(()=>[a(ae),a(R,{class:"cancel-btn",variant:"text",onClick:v},{default:i(()=>o[2]||(o[2]=[T(" Cancel ")])),_:1}),a(R,{class:"submit-btn",onClick:l,disabled:!_.value||!u.value},{default:i(()=>o[3]||(o[3]=[T(" Save ")])),_:1},8,["disabled"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),It=N(Bt,[["__scopeId","data-v-bb63ed31"]]),xt={class:"dialog-content"},jt=q({__name:"TournamentEndDateDialog",props:{modelValue:{type:Boolean},currentEndDate:{},error:{}},emits:["update:modelValue","save"],setup(U,{emit:$}){const c=U,z=$,t=h(c.currentEndDate),f=h("");B(()=>c.currentEndDate,_=>{t.value=_}),B(()=>c.error,_=>{_&&(f.value=_)});const D=()=>{var _;if(!((_=t.value)!=null&&_.trim())){f.value="End date cannot be empty";return}z("save",t.value)};return(_,u)=>(d(),V(te,{modelValue:_.modelValue,"onUpdate:modelValue":u[2]||(u[2]=r=>_.$emit("update:modelValue",r)),"max-width":"500px",class:"end-date-dialog"},{default:i(()=>[a(ee,{class:"dialog-card"},{default:i(()=>[s("div",xt,[a(Q,{class:"dialog-title"},{default:i(()=>u[3]||(u[3]=[T("Edit End Date")])),_:1}),a(X,null,{default:i(()=>[a(Y,{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=r=>t.value=r),label:"End Date",type:"datetime-local",variant:"outlined",error:!!f.value,"error-messages":f.value},null,8,["modelValue","error","error-messages"])]),_:1}),a(Z,{class:"dialog-actions"},{default:i(()=>[a(ae),a(R,{class:"cancel-btn",variant:"text",onClick:u[1]||(u[1]=r=>_.$emit("update:modelValue",!1))},{default:i(()=>u[4]||(u[4]=[T(" Cancel ")])),_:1}),a(R,{class:"submit-btn",onClick:D,disabled:!t.value},{default:i(()=>u[5]||(u[5]=[T(" Save ")])),_:1},8,["disabled"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),Rt=N(jt,[["__scopeId","data-v-5e7995c9"]]),qt={class:"dialog-content"},Nt=q({__name:"TournamentPrizeDialog",props:{modelValue:{type:Boolean},currentPrizePool:{},error:{}},emits:["update:modelValue","save"],setup(U,{emit:$}){const c=U,z=$,t=h(c.currentPrizePool),f=h(""),D=S({get:()=>c.modelValue,set:l=>z("update:modelValue",l)}),_={required:l=>!!l||"Prize pool is required",positive:l=>{const e=Number(l);return!!e&&e>0||"Prize pool must be greater than 0"}},u=S(()=>{const l=t.value,e=Number(l);return _.required(l)===!0&&!!e&&e>0}),r=S(()=>Number(t.value)!==c.currentPrizePool);B(()=>c.modelValue,l=>{l&&(t.value=c.currentPrizePool,f.value="")}),B(()=>c.error,l=>{l&&(f.value=l)});const v=()=>{t.value=c.currentPrizePool,f.value="",D.value=!1},M=()=>{const l=Number(t.value);if(!l||l<=0){f.value=t.value?"Prize pool must be greater than 0":"Prize pool is required";return}z("save",l),v()};return(l,e)=>(d(),V(te,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=o=>D.value=o),"max-width":"500px",class:"prize-dialog"},{default:i(()=>[a(ee,{class:"dialog-card"},{default:i(()=>[s("div",qt,[a(Q,{class:"dialog-title"},{default:i(()=>e[2]||(e[2]=[T("Edit Prize Pool")])),_:1}),a(X,null,{default:i(()=>[a(Y,{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value=o),label:"Prize Pool (Kitty Kibbles)",type:"number",variant:"outlined",rules:[_.required,_.positive],error:!!f.value,"error-messages":f.value},null,8,["modelValue","rules","error","error-messages"])]),_:1}),a(Z,{class:"dialog-actions"},{default:i(()=>[a(ae),a(R,{class:"cancel-btn",variant:"text",onClick:v},{default:i(()=>e[3]||(e[3]=[T(" Cancel ")])),_:1}),a(R,{class:"submit-btn",onClick:M,disabled:!u.value||!r.value},{default:i(()=>e[4]||(e[4]=[T(" Save ")])),_:1},8,["disabled"])]),_:1})])]),_:1})]),_:1},8,["modelValue"]))}}),Lt=N(Nt,[["__scopeId","data-v-bfefb911"]]),Ot={class:"tournament-wrapper"},Ht={class:"content-wrapper"},Jt={key:1,class:"loading-container"},Kt={key:2,class:"error-container"},Wt=q({__name:"SingleTournament",setup(U){const $=Ce(),c=we(),z=h(!1),t=h(null),f=h(!0),D=h(null),_=h(!1),u=h(!1),r=h(!1),v=h(""),M=h(""),l=h(""),e=h(!1),o=h(null),P=h([]),oe=h(!1),se=h(null),I=h([]),G=h(!1),ne=h(null),me=S(()=>{var p,n;return(n=(p=t.value)==null?void 0:p.prizes)!=null&&n.length?t.value.prizes.reduce((m,C)=>m+C.prize_cut,0):0}),re=S(()=>!z.value||!t.value||!c.isAuthenticated?!1:c.userRole==="admin"||t.value.director_id===c.userId),pe=p=>p&&{"round robin":Pe,"one off match":be,"single elimination":$e}[p]||"",ve=async()=>{var p;if(!((p=t.value)!=null&&p.title)){console.log("No tournament title available:",t.value);return}try{oe.value=!0,se.value=null;const n=`${A}/matches/?tournament_title=${encodeURIComponent(t.value.title)}`;console.log("Attempting to fetch matches from URL:",n);const m=await fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json",...c.token?{Authorization:`Bearer ${c.token}`}:{}}});if(console.log("Response status:",m.status),console.log("Response headers:",Object.fromEntries(m.headers.entries())),!m.ok){console.log("Response not OK. Full response:",m);const E=await m.text();throw console.log("Error response text:",E),new Error("Failed to fetch tournament matches")}const C=await m.json();console.log("Received matches data:",C),P.value=C}catch(n){console.error("Detailed error in fetchAllTournamentMatches:",n),console.error("Error stack:",n.stack),se.value="Failed to load tournament matches"}finally{oe.value=!1}},_e=async()=>{if(o.value)try{const p=await fetch(`${A}/matches/${o.value.id}`);if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const n=await p.json();I.value&&(I.value=I.value.map(m=>m.id===n.id?n:m)),P.value&&(P.value=P.value.map(m=>m.id===n.id?n:m)),o.value=n}catch(p){console.error("Error refreshing match:",p)}},fe=async()=>{var p;if((p=t.value)!=null&&p.title)try{G.value=!0,ne.value=null;const n=`${A}/matches/?tournament_title=${encodeURIComponent(t.value.title)}&is_finished=true`;console.log("Fetching past matches from:",n);const m=await fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json",...c.token?{Authorization:`Bearer ${c.token}`}:{}}});if(!m.ok)throw new Error("Failed to fetch past matches");const C=await m.json();I.value=C,console.log("Past matches loaded:",I.value)}catch(n){console.error("Error fetching past matches:",n),ne.value="Failed to load past matches"}finally{G.value=!1}},K=async()=>{try{f.value=!0,D.value=null;const p=await fetch(`${A}/tournaments/${$.params.id}`);if(!p.ok)throw new Error("Failed to fetch tournament details");const n=await p.json();t.value=n}catch(p){console.error("Error fetching tournament:",p),D.value="Failed to load tournament details"}finally{f.value=!1}},he=async p=>{var n;try{if(!t.value)return;console.log("Updating title with:",{tournamentId:t.value.id,newTitle:p});const m=await fetch(`${A}/tournaments/${t.value.id}?title=${encodeURIComponent(p)}`,{method:"PUT",headers:{Authorization:`Bearer ${c.token}`,"Content-Type":"application/json"}}),C=await m.text();if(!m.ok){let E;try{const y=JSON.parse(C);console.log("Error data:",y),console.log("Error data type:",typeof y),y.detail&&Array.isArray(y.detail)&&((n=y.detail[0])!=null&&n.msg)?E=y.detail[0].msg:E=y.detail||"Failed to update tournament title"}catch{E="Failed to update tournament title"}v.value=E;return}await K(),_.value=!1}catch(m){console.error("Update error:",m),v.value="An unexpected error occurred while updating the title"}},ge=async p=>{var n;try{if(!t.value)return;const m=await fetch(`${A}/tournaments/${t.value.id}?end_date=${encodeURIComponent(p)}`,{method:"PUT",headers:{Authorization:`Bearer ${c.token}`,"Content-Type":"application/json"}}),C=await m.text();if(!m.ok){let E;try{const y=JSON.parse(C);y.detail&&Array.isArray(y.detail)&&((n=y.detail[0])!=null&&n.msg)?E=y.detail[0].msg:E=y.detail||"Failed to update end date"}catch{E="Failed to update end date"}M.value=E;return}await K(),u.value=!1}catch(m){console.error("Update error:",m),M.value="An unexpected error occurred while updating the end date"}},ye=async p=>{var n;try{if(!t.value)return;console.log("Updating prize pool with:",{tournamentId:t.value.id,newPrizePool:p});const m=await fetch(`${A}/tournaments/${t.value.id}?prize_pool=${p}`,{method:"PUT",headers:{Authorization:`Bearer ${c.token}`,"Content-Type":"application/json"}}),C=await m.text();if(!m.ok){let E;try{const y=JSON.parse(C);y.detail&&Array.isArray(y.detail)&&((n=y.detail[0])!=null&&n.msg)?E=y.detail[0].msg:E=y.detail||"Failed to update prize pool"}catch{E="Failed to update prize pool"}l.value=E;return}await K(),r.value=!1}catch(m){console.error("Update error:",m),l.value="An unexpected error occurred while updating the prize pool"}},ke=async p=>{o.value=p,e.value=!0};return De(async()=>{var p,n,m;console.log("Component mounted"),await c.initializeFromToken(),console.log("Auth initialized"),z.value=!0,await K(),console.log("Tournament fetched:",t.value),console.log("Current stage:",(p=t.value)==null?void 0:p.current_stage),await fe(),((n=t.value)==null?void 0:n.current_stage)==="finished"?(console.log("Tournament is finished, fetching all matches..."),await ve()):console.log("Tournament is not finished, current stage:",(m=t.value)==null?void 0:m.current_stage)}),(p,n)=>{var m,C,E,y;return d(),k("div",Ot,[s("div",{class:"header-image",style:Ee({backgroundImage:`url(${pe((m=t.value)==null?void 0:m.tournament_format)})`})},null,4),n[7]||(n[7]=s("div",{class:"header-overlay"},null,-1)),s("div",Ht,[t.value?(d(),V(ze,{key:0},{default:i(()=>[a(je,{tournament:t.value,canEdit:re.value,onOpenTitleEdit:n[0]||(n[0]=b=>_.value=!0),onOpenEndDateEdit:n[1]||(n[1]=b=>u.value=!0)},null,8,["tournament","canEdit"]),a(At,{tournament:t.value,pastMatches:I.value,isPastMatchesLoading:G.value,canEdit:re.value,onOpenPrizeEdit:n[2]||(n[2]=b=>r.value=!0),onOpenMatchDialog:ke},null,8,["tournament","pastMatches","isPastMatchesLoading","canEdit"])]),_:1})):f.value?(d(),k("div",Jt,[a(ce,{indeterminate:"",color:"#42DDF2FF"})])):D.value?(d(),k("div",Kt,g(D.value),1)):F("",!0)]),a(It,{modelValue:_.value,"onUpdate:modelValue":n[3]||(n[3]=b=>_.value=b),currentTitle:((C=t.value)==null?void 0:C.title)||"",error:v.value,onSave:he},null,8,["modelValue","currentTitle","error"]),a(Rt,{modelValue:u.value,"onUpdate:modelValue":n[4]||(n[4]=b=>u.value=b),"current-end-date":((E=t.value)==null?void 0:E.end_date)||"",error:M.value,onSave:ge},null,8,["modelValue","current-end-date","error"]),a(Lt,{modelValue:r.value,"onUpdate:modelValue":n[5]||(n[5]=b=>r.value=b),currentPrizePool:me.value,error:l.value,onSave:ye},null,8,["modelValue","currentPrizePool","error"]),a(Me,{modelValue:e.value,"onUpdate:modelValue":n[6]||(n[6]=b=>e.value=b),match:o.value,tournamentDirectorId:(y=t.value)==null?void 0:y.director_id,onMatchUpdate:_e},null,8,["modelValue","match","tournamentDirectorId"])])}}}),sa=N(Wt,[["__scopeId","data-v-ac630a79"]]);export{sa as default};
